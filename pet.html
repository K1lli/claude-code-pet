<!DOCTYPE html>
<html>
<head>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body {
    background: transparent;
    overflow: hidden;
    width: 200px;
    height: 220px;
    user-select: none;
    -webkit-app-region: drag;
  }

  .scene {
    width: 200px;
    height: 220px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    position: relative;
  }

  .status-label {
    font-family: 'Segoe UI', sans-serif;
    font-size: 11px;
    color: #fff;
    background: rgba(0,0,0,0.55);
    padding: 2px 10px;
    border-radius: 8px;
    margin-bottom: 6px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    transition: background 0.3s;
    z-index: 10;
  }

  /* ---- CREATURE ---- */
  .creature {
    position: relative;
    width: 120px;
    height: 120px;
    transition: filter 0.3s;
  }

  .body {
    position: absolute;
    left: 20px; top: 20px;
    width: 80px; height: 80px;
    background: radial-gradient(circle at 35% 35%, #d4a574, #c4956a);
    border-radius: 50% 50% 50% 50% / 45% 45% 55% 55%;
    box-shadow: 0 4px 18px rgba(0,0,0,0.25), inset 0 -6px 12px rgba(0,0,0,0.1);
    transition: background 0.4s, transform 0.2s;
  }

  .eye {
    position: absolute;
    width: 14px; height: 16px;
    background: #fff;
    border-radius: 50%;
    top: 38px;
    box-shadow: inset 0 0 3px rgba(0,0,0,0.15);
    overflow: hidden;
    z-index: 2;
  }
  .eye.left { left: 38px; }
  .eye.right { left: 68px; }

  .pupil {
    width: 8px; height: 9px;
    background: #2c1810;
    border-radius: 50%;
    position: absolute;
    top: 4px; left: 3px;
    transition: transform 0.2s;
  }
  .pupil::after {
    content: '';
    width: 3px; height: 3px;
    background: #fff;
    border-radius: 50%;
    position: absolute;
    top: 1px; left: 1px;
  }

  .mouth {
    position: absolute;
    top: 58px; left: 52px;
    width: 16px; height: 8px;
    border-bottom: 3px solid #5a3825;
    border-radius: 0 0 50% 50%;
    transition: all 0.3s;
    z-index: 2;
  }

  .foot {
    position: absolute;
    bottom: 8px;
    width: 20px; height: 10px;
    background: #b8845a;
    border-radius: 50%;
  }
  .foot.left { left: 30px; }
  .foot.right { left: 70px; }

  .antenna {
    position: absolute;
    top: 6px; left: 55px;
    width: 4px; height: 18px;
    background: #c4956a;
    border-radius: 2px;
    transform-origin: bottom center;
    z-index: 1;
  }
  .antenna::after {
    content: '';
    position: absolute;
    top: -6px; left: -4px;
    width: 12px; height: 12px;
    background: radial-gradient(circle, #ff9f43, #f0932b);
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(255,159,67,0.5);
  }

  .shadow {
    width: 80px;
    height: 12px;
    background: rgba(0,0,0,0.2);
    border-radius: 50%;
    margin-top: -2px;
    transition: all 0.3s;
    flex-shrink: 0;
  }

  /* ---- LAYERS ---- */
  .accessory-layer {
    position: absolute;
    top: 0; left: 0;
    width: 120px; height: 120px;
    pointer-events: none;
    z-index: 5;
  }
  .accessory-layer svg {
    position: absolute;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .accessory-layer svg.active { opacity: 1; }

  .particle-layer {
    position: absolute;
    top: -20px; left: -20px;
    width: 160px; height: 160px;
    pointer-events: none;
    z-index: 4;
  }
  .particle-layer .p {
    position: absolute;
    opacity: 0;
    pointer-events: none;
    line-height: 1;
  }

  /* ── BASE STATE ANIMATIONS ─────────────────────────────────────── */

  /* IDLE */
  .state-idle .body { animation: idle-bob 2.5s ease-in-out infinite; }
  .state-idle .antenna { animation: antenna-sway 3s ease-in-out infinite; }
  @keyframes idle-bob {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
  }
  @keyframes antenna-sway {
    0%, 100% { transform: rotate(-5deg); }
    50% { transform: rotate(5deg); }
  }

  /* THINKING */
  .state-thinking .body {
    animation: think-ponder 2.5s ease-in-out infinite;
    background: radial-gradient(circle at 35% 35%, #ddb08a, #c4956a);
  }
  .state-thinking .antenna::after { animation: think-glow 1.2s ease-in-out infinite; }
  .state-thinking .pupil { animation: think-look-up 3s ease-in-out infinite; }
  .state-thinking .mouth {
    width: 12px; height: 5px;
    border-bottom: 2px solid #5a3825;
    border-radius: 0 0 40% 40%;
    top: 59px; left: 54px;
  }
  @keyframes think-ponder {
    0%, 100% { transform: scale(1) translateY(0); }
    40% { transform: scale(1.04) translateY(-3px); }
    70% { transform: scale(1.02) translateY(-1px); }
  }
  @keyframes think-look-up {
    0%, 100% { transform: translate(1px, -2px); }
    40% { transform: translate(2px, -3px); }
    70% { transform: translate(-1px, -2px); }
  }
  @keyframes think-glow {
    0%, 100% { box-shadow: 0 0 8px rgba(255,159,67,0.5); }
    50% { box-shadow: 0 0 20px rgba(255,159,67,0.9); }
  }
  @keyframes think-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.06); }
  }
  @keyframes think-eyes {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(3px); }
    75% { transform: translateX(-3px); }
  }

  /* CODING */
  .state-coding .body {
    animation: code-type 0.35s ease-in-out infinite;
    box-shadow: 0 4px 18px rgba(0,0,0,0.25), inset 0 -6px 12px rgba(0,0,0,0.1),
                0 8px 25px rgba(100,180,255,0.15);
  }
  .state-coding .mouth {
    width: 10px; height: 10px; border: none;
    background: #5a3825; border-radius: 50%;
    top: 57px; left: 55px;
  }
  .state-coding .pupil { animation: code-eyes 2s ease-in-out infinite; }
  .state-coding .foot.left { animation: code-foot-l 0.2s ease-in-out infinite; }
  .state-coding .foot.right { animation: code-foot-r 0.2s ease-in-out infinite; }
  .state-coding .antenna::after {
    animation: code-glow 2s ease-in-out infinite;
  }
  @keyframes code-type {
    0%, 100% { transform: rotate(-0.5deg) translateY(0) scaleY(1); }
    40% { transform: rotate(0.5deg) translateY(-3px) scaleY(0.97); }
    70% { transform: rotate(-0.3deg) translateY(-1px) scaleY(0.98); }
  }
  @keyframes code-glow {
    0%, 100% {
      background: radial-gradient(circle, #64d2ff, #0984e3);
      box-shadow: 0 0 14px rgba(9,132,227,0.8);
    }
    50% {
      background: radial-gradient(circle, #a0e9ff, #74b9ff);
      box-shadow: 0 0 22px rgba(116,185,255,0.9);
    }
  }
  @keyframes code-eyes {
    0%, 100% { transform: translate(0, 3px); }
    50% { transform: translate(0, 4px); }
  }
  @keyframes code-foot-l {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
  }
  @keyframes code-foot-r {
    0%, 100% { transform: translateY(-4px); }
    50% { transform: translateY(0); }
  }

  /* SUCCESS */
  .state-success .body {
    animation: success-bounce 0.5s ease-in-out infinite;
    background: radial-gradient(circle at 35% 35%, #e8c4a0, #d4a574);
  }
  .state-success .eye { animation: success-happy-eyes 0.5s ease-in-out infinite; }
  .state-success .mouth {
    width: 22px; height: 12px;
    border-bottom: 3px solid #5a3825;
    border-radius: 0 0 50% 50%;
    top: 56px; left: 49px;
  }
  .state-success .antenna::after {
    background: radial-gradient(circle, #2ecc71, #27ae60);
    animation: success-antenna-burst 0.8s ease-in-out infinite;
  }
  .state-success .shadow { animation: success-shadow 0.5s ease-in-out infinite; }
  @keyframes success-bounce {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-16px) scale(1.05); }
  }
  @keyframes success-happy-eyes {
    0%, 100% { transform: scaleY(1); }
    50% { transform: scaleY(0.6) translateY(2px); }
  }
  @keyframes success-antenna-burst {
    0%, 100% { box-shadow: 0 0 14px rgba(46,204,113,0.7); }
    50% { box-shadow: 0 0 30px rgba(46,204,113,1); }
  }
  @keyframes success-shadow {
    0%, 100% { transform: scaleX(1); opacity: 0.2; }
    50% { transform: scaleX(0.7); opacity: 0.1; }
  }

  /* ERROR */
  .state-error .body {
    animation: error-recoil 0.8s ease-in-out infinite;
    background: radial-gradient(circle at 35% 35%, #e08080, #c96a6a);
    box-shadow: 0 4px 18px rgba(0,0,0,0.25), inset 0 -6px 12px rgba(0,0,0,0.1),
                0 0 20px rgba(231,76,60,0.15);
  }
  .state-error .mouth {
    border-bottom: none;
    border-top: 3px solid #5a3825;
    border-radius: 50% 50% 0 0;
    top: 60px;
    animation: error-mouth-tremble 0.3s ease-in-out infinite;
  }
  .state-error .eye { animation: error-squint 0.8s ease-in-out infinite; }
  .state-error .antenna::after {
    background: radial-gradient(circle, #e74c3c, #c0392b);
    animation: error-antenna-flash 0.5s ease-in-out infinite;
  }
  @keyframes error-recoil {
    0%, 100% { transform: translateX(0) translateY(0) scale(1); }
    15% { transform: translateX(-5px) translateY(-3px) scale(1.04); }
    35% { transform: translateX(4px) translateY(0) scale(0.97); }
    55% { transform: translateX(-3px) translateY(0) scale(1.01); }
    75% { transform: translateX(2px) translateY(0) scale(0.99); }
  }
  @keyframes error-squint {
    0%, 100% { transform: scaleY(0.7); }
    50% { transform: scaleY(0.5); }
  }
  @keyframes error-mouth-tremble {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(1px); }
  }
  @keyframes error-antenna-flash {
    0%, 100% { box-shadow: 0 0 14px rgba(231,76,60,0.7); }
    50% { box-shadow: 0 0 30px rgba(231,76,60,1); }
  }

  /* ── KEYWORD STATE ANIMATIONS ──────────────────────────────────── */

  /* SEARCHING */
  .state-searching .body { animation: search-peer 1.2s ease-in-out infinite; }
  .state-searching .eye { transform: scale(1.3); }
  .state-searching .pupil { animation: search-scan 1.2s ease-in-out infinite; }
  .state-searching .antenna::after {
    background: radial-gradient(circle, #74b9ff, #0984e3);
    animation: search-glow 1.5s ease-in-out infinite;
  }
  .state-searching .foot.left { animation: code-foot-l 0.4s ease-in-out infinite; }
  .state-searching .foot.right { animation: code-foot-r 0.4s ease-in-out infinite; }
  @keyframes search-peer {
    0%, 100% { transform: translateX(0) translateY(0) rotate(0deg); }
    30% { transform: translateX(4px) translateY(-2px) rotate(2deg); }
    70% { transform: translateX(-4px) translateY(-1px) rotate(-2deg); }
  }
  @keyframes search-scan {
    0%, 100% { transform: translate(-3px, 0); }
    30% { transform: translate(3px, -1px); }
    70% { transform: translate(-2px, 1px); }
  }
  @keyframes search-glow {
    0%, 100% { box-shadow: 0 0 14px rgba(9,132,227,0.7); }
    50% { box-shadow: 0 0 22px rgba(9,132,227,1); }
  }

  /* READING */
  .state-reading .body { animation: read-lean 3s ease-in-out infinite; }
  .state-reading .pupil { animation: read-eyes 2.5s steps(3) infinite; }
  .state-reading .mouth {
    width: 10px; height: 5px;
    border-bottom: 2px solid #5a3825;
    border-radius: 0 0 50% 50%;
    top: 59px; left: 55px;
  }
  .state-reading .antenna::after {
    background: radial-gradient(circle, #a29bfe, #6c5ce7);
    box-shadow: 0 0 12px rgba(108,92,231,0.6);
  }
  @keyframes read-lean {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(2px) rotate(1deg); }
  }
  @keyframes read-eyes {
    0%, 100% { transform: translate(-2px, 3px); }
    33% { transform: translate(2px, 3px); }
    66% { transform: translate(0px, 2px); }
  }

  /* DEBUGGING */
  .state-debugging .body {
    animation: debug-hunt 0.6s ease-in-out infinite;
    background: radial-gradient(circle at 35% 35%, #fdcb6e, #e17055);
  }
  .state-debugging .eye { transform: scale(1.2); }
  .state-debugging .pupil { width: 6px; height: 6px; top: 5px; }
  .state-debugging .mouth {
    width: 14px; height: 3px;
    border-bottom: 2px solid #5a3825;
    border-radius: 0;
    top: 59px; left: 53px;
  }
  .state-debugging .foot.left { animation: code-foot-l 0.2s ease-in-out infinite; }
  .state-debugging .foot.right { animation: code-foot-r 0.2s ease-in-out infinite; }
  .state-debugging .antenna::after {
    background: radial-gradient(circle, #fd79a8, #e84393);
    box-shadow: 0 0 14px rgba(232,67,147,0.7);
    animation: debug-flash 0.4s ease-in-out infinite;
  }
  @keyframes debug-hunt {
    0%, 100% { transform: translateX(0) translateY(0); }
    25% { transform: translateX(3px) translateY(-2px); }
    75% { transform: translateX(-3px) translateY(-1px); }
  }
  @keyframes debug-flash {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* INSTALLING / DOWNLOADING */
  .state-installing .body, .state-downloading .body {
    animation: install-pulse 1s ease-in-out infinite;
  }
  .state-installing .mouth, .state-downloading .mouth {
    width: 8px; height: 8px; border: none;
    background: #5a3825; border-radius: 50%;
    top: 58px; left: 56px;
  }
  .state-installing .antenna::after, .state-downloading .antenna::after {
    background: radial-gradient(circle, #00cec9, #00b894);
    box-shadow: 0 0 14px rgba(0,206,201,0.7);
    animation: install-spin 1s linear infinite;
  }
  .state-installing .pupil, .state-downloading .pupil {
    animation: think-eyes 1.5s ease-in-out infinite;
  }
  @keyframes install-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.04); }
  }
  @keyframes install-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* TESTING */
  .state-testing .body { animation: test-nod 0.8s ease-in-out infinite; }
  .state-testing .mouth { width: 8px; height: 4px; border-bottom: 2px solid #5a3825; }
  .state-testing .pupil { animation: test-check 1.6s steps(2) infinite; }
  .state-testing .antenna::after {
    background: radial-gradient(circle, #ffeaa7, #fdcb6e);
    animation: test-antenna-pulse 0.8s ease-in-out infinite;
  }
  @keyframes test-nod {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    30% { transform: translateY(-4px) rotate(-3deg); }
    60% { transform: translateY(-1px) rotate(2deg); }
  }
  @keyframes test-check {
    0%, 100% { transform: translate(-2px, -1px); }
    50% { transform: translate(2px, 1px); }
  }
  @keyframes test-antenna-pulse {
    0%, 100% { box-shadow: 0 0 12px rgba(253,203,110,0.7); }
    50% { box-shadow: 0 0 20px rgba(46,204,113,0.8); }
  }

  /* DEPLOYING */
  .state-deploying .body {
    animation: deploy-launch 1.5s ease-in-out infinite;
    background: radial-gradient(circle at 35% 35%, #fab1a0, #e17055);
  }
  .state-deploying .shadow { animation: success-shadow 1.5s ease-in-out infinite; }
  .state-deploying .mouth {
    width: 12px; height: 12px; border: none;
    background: #5a3825; border-radius: 50%;
    top: 55px; left: 54px;
  }
  .state-deploying .antenna::after {
    background: radial-gradient(circle, #ff7675, #d63031);
    box-shadow: 0 0 20px rgba(214,48,49,0.8);
  }
  @keyframes deploy-launch {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-25px) scale(1.08); }
  }

  /* COOKING */
  .state-cooking .body {
    animation: cook-stir 0.6s ease-in-out infinite;
    background: radial-gradient(circle at 35% 35%, #dfe6e9, #b2bec3);
  }
  .state-cooking .mouth {
    width: 14px; height: 8px;
    border-bottom: 3px solid #5a3825;
    border-radius: 0 0 50% 50%;
    top: 57px; left: 53px;
  }
  .state-cooking .pupil { animation: cook-eyes 1.2s ease-in-out infinite; }
  .state-cooking .antenna::after {
    background: radial-gradient(circle, #ff7675, #d63031);
    box-shadow: 0 0 12px rgba(255,118,117,0.6);
  }
  @keyframes cook-stir {
    0%, 100% { transform: rotate(-3deg) translateX(-1px); }
    50% { transform: rotate(3deg) translateX(1px); }
  }
  @keyframes cook-eyes {
    0%, 100% { transform: translate(0, 2px); }
    50% { transform: translate(1px, 2px); }
  }

  /* HATCHING */
  .state-hatching .body {
    animation: hatch-wiggle 0.4s ease-in-out infinite;
    transform-origin: center bottom;
  }
  .state-hatching .foot { opacity: 0; }
  .state-hatching .eye { animation: hatch-squeeze 0.8s ease-in-out infinite; }
  .state-hatching .antenna::after {
    background: radial-gradient(circle, #ffeaa7, #fdcb6e);
    box-shadow: 0 0 12px rgba(253,203,110,0.8);
    animation: think-glow 0.8s ease-in-out infinite;
  }
  @keyframes hatch-wiggle {
    0%, 100% { transform: rotate(0deg) translateY(0); }
    25% { transform: rotate(-5deg) translateY(-2px); }
    75% { transform: rotate(5deg) translateY(-2px); }
  }
  @keyframes hatch-squeeze {
    0%, 100% { transform: scaleY(1); }
    50% { transform: scaleY(0.7); }
  }

  /* DELETING */
  .state-deleting .body {
    animation: delete-sweep 0.5s ease-in-out infinite;
    background: radial-gradient(circle at 35% 35%, #dfe6e9, #636e72);
  }
  .state-deleting .eye { animation: error-squint 1s ease-in-out infinite; }
  .state-deleting .mouth {
    border-bottom: none;
    border-top: 2px solid #5a3825;
    border-radius: 50% 50% 0 0;
    top: 60px; width: 12px;
  }
  .state-deleting .foot.left { animation: code-foot-l 0.25s ease-in-out infinite; }
  .state-deleting .foot.right { animation: code-foot-r 0.25s ease-in-out infinite; }
  .state-deleting .antenna::after {
    background: radial-gradient(circle, #636e72, #2d3436);
    box-shadow: 0 0 10px rgba(45,52,54,0.5);
  }
  @keyframes delete-sweep {
    0%, 100% { transform: translateX(0) rotate(0deg); }
    25% { transform: translateX(6px) rotate(3deg); }
    75% { transform: translateX(-6px) rotate(-3deg); }
  }

  /* ── PARTICLE KEYFRAMES ────────────────────────────────────────── */
  @keyframes float-up {
    0% { opacity: 0; transform: translateY(60px) scale(0.5); }
    15% { opacity: 0.9; transform: translateY(40px) scale(1); }
    100% { opacity: 0; transform: translateY(-30px) scale(0.6); }
  }
  @keyframes rain-down {
    0% { opacity: 0; transform: translateY(-30px); }
    20% { opacity: 0.9; }
    100% { opacity: 0; transform: translateY(80px); }
  }
  @keyframes wiggle-float {
    0% { opacity: 0; transform: translateY(50px) rotate(0deg); }
    20% { opacity: 0.9; }
    100% { opacity: 0; transform: translateY(-20px) rotate(20deg); }
  }
  @keyframes orbit {
    0% { opacity: 0.8; transform: rotate(0deg) translateX(45px) rotate(0deg); }
    100% { opacity: 0.3; transform: rotate(360deg) translateX(45px) rotate(-360deg); }
  }
  @keyframes pop-up {
    0% { opacity: 0; transform: translateY(10px) scale(0); }
    30% { opacity: 1; transform: translateY(-5px) scale(1.2); }
    60% { opacity: 1; transform: translateY(-10px) scale(1); }
    100% { opacity: 0; transform: translateY(-25px) scale(0.8); }
  }
  @keyframes crack-shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-2px) rotate(-1deg); }
    40% { transform: translateX(2px) rotate(1deg); }
    60% { transform: translateX(-1px); }
    80% { transform: translateX(1px); }
  }
  @keyframes sway-float {
    0% { opacity: 0; transform: translateY(50px) translateX(0); }
    15% { opacity: 0.8; }
    50% { transform: translateY(10px) translateX(8px); }
    100% { opacity: 0; transform: translateY(-25px) translateX(-5px); }
  }
</style>
</head>
<body>
  <div class="scene" id="scene">
    <div class="status-label" id="statusLabel">idle</div>
    <div class="creature" id="creature">
      <div class="antenna"></div>
      <div class="body"></div>
      <div class="eye left"><div class="pupil"></div></div>
      <div class="eye right"><div class="pupil"></div></div>
      <div class="mouth"></div>
      <div class="foot left"></div>
      <div class="foot right"></div>
      <div class="accessory-layer" id="accessoryLayer"></div>
      <div class="particle-layer" id="particleLayer"></div>
    </div>
    <div class="shadow"></div>
  </div>

  <script>
    const { ipcRenderer } = require("electron");
    const scene = document.getElementById("scene");
    const label = document.getElementById("statusLabel");
    const accessoryLayer = document.getElementById("accessoryLayer");
    const particleLayer = document.getElementById("particleLayer");
    let currentState = "idle";
    let particleInterval = null;

    // ── SVG PARTICLE SHAPES ─────────────────────────────────────────
    // Tiny reusable SVG templates. Use COLOR as a placeholder to tint.

    const SVG = {
      // 4-point sparkle star
      sparkle: (c) => `<svg width="10" height="10" viewBox="0 0 10 10"><path d="M5,0 L6,4 L10,5 L6,6 L5,10 L4,6 L0,5 L4,4Z" fill="${c}"/></svg>`,
      // 5-point star
      star: (c) => `<svg width="12" height="12" viewBox="0 0 12 12"><path d="M6,0L7.5,4.2L12,4.6L8.5,7.8L9.7,12L6,9.8L2.3,12L3.5,7.8L0,4.6L4.5,4.2Z" fill="${c}"/></svg>`,
      // small circle / dot
      dot: (c) => `<svg width="8" height="8"><circle cx="4" cy="4" r="3.5" fill="${c}"/></svg>`,
      // hollow circle
      ring: (c) => `<svg width="10" height="10"><circle cx="5" cy="5" r="4" fill="none" stroke="${c}" stroke-width="1.5"/></svg>`,
      // small triangle
      tri: (c) => `<svg width="10" height="10" viewBox="0 0 10 10"><polygon points="5,0 10,10 0,10" fill="${c}"/></svg>`,
      // X mark
      cross: (c) => `<svg width="8" height="8" viewBox="0 0 8 8"><line x1="1" y1="1" x2="7" y2="7" stroke="${c}" stroke-width="2" stroke-linecap="round"/><line x1="7" y1="1" x2="1" y2="7" stroke="${c}" stroke-width="2" stroke-linecap="round"/></svg>`,
      // checkmark
      check: (c) => `<svg width="10" height="10" viewBox="0 0 10 10"><path d="M1,5.5 L3.5,8 L9,2" fill="none" stroke="${c}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
      // tiny gear/cog
      gear: (c) => `<svg width="12" height="12" viewBox="0 0 12 12"><circle cx="6" cy="6" r="2.5" fill="none" stroke="${c}" stroke-width="1.5"/><line x1="6" y1="0" x2="6" y2="2.5" stroke="${c}" stroke-width="1.5"/><line x1="6" y1="9.5" x2="6" y2="12" stroke="${c}" stroke-width="1.5"/><line x1="0" y1="6" x2="2.5" y2="6" stroke="${c}" stroke-width="1.5"/><line x1="9.5" y1="6" x2="12" y2="6" stroke="${c}" stroke-width="1.5"/></svg>`,
      // small diamond
      diamond: (c) => `<svg width="8" height="10" viewBox="0 0 8 10"><polygon points="4,0 8,5 4,10 0,5" fill="${c}"/></svg>`,
      // tiny lightning bolt
      bolt: (c) => `<svg width="8" height="14" viewBox="0 0 8 14"><polygon points="5,0 1,7 4,7 3,14 7,6 4,6" fill="${c}"/></svg>`,
      // small cloud puff
      cloud: (c) => `<svg width="14" height="10" viewBox="0 0 14 10"><ellipse cx="7" cy="6" rx="6" ry="4" fill="${c}" opacity="0.7"/><ellipse cx="4" cy="5" rx="4" ry="3.5" fill="${c}" opacity="0.6"/><ellipse cx="10" cy="5" rx="4" ry="3" fill="${c}" opacity="0.6"/></svg>`,
      // tiny page/file
      page: (c) => `<svg width="9" height="11" viewBox="0 0 9 11"><rect x="0" y="0" width="9" height="11" rx="1" fill="${c}"/><line x1="2" y1="3" x2="7" y2="3" stroke="#fff" stroke-width="0.8"/><line x1="2" y1="5.5" x2="6" y2="5.5" stroke="#fff" stroke-width="0.8"/><line x1="2" y1="8" x2="5" y2="8" stroke="#fff" stroke-width="0.8"/></svg>`,
      // down arrow
      arrowDown: (c) => `<svg width="8" height="10" viewBox="0 0 8 10"><line x1="4" y1="0" x2="4" y2="8" stroke="${c}" stroke-width="2"/><path d="M1,5 L4,9 L7,5" fill="none" stroke="${c}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
      // small bug with body + legs
      bug: (c) => `<svg width="12" height="12" viewBox="0 0 12 12"><ellipse cx="6" cy="7" rx="3.5" ry="4" fill="${c}"/><circle cx="6" cy="3" r="2" fill="${c}"/><line x1="2" y1="5" x2="0" y2="3" stroke="${c}" stroke-width="1"/><line x1="10" y1="5" x2="12" y2="3" stroke="${c}" stroke-width="1"/><line x1="2" y1="8" x2="0" y2="9" stroke="${c}" stroke-width="1"/><line x1="10" y1="8" x2="12" y2="9" stroke="${c}" stroke-width="1"/><circle cx="5" cy="2.5" r="0.7" fill="#fff"/><circle cx="7" cy="2.5" r="0.7" fill="#fff"/></svg>`,
      // dust puff
      dust: (c) => `<svg width="12" height="8" viewBox="0 0 12 8"><circle cx="3" cy="5" r="2.5" fill="${c}" opacity="0.5"/><circle cx="7" cy="4" r="3" fill="${c}" opacity="0.4"/><circle cx="10" cy="5" r="2" fill="${c}" opacity="0.3"/></svg>`,
    };

    // ── ANIMATION CONFIG ────────────────────────────────────────────
    // To add a new animation:
    //   1. Add a CSS .state-yourKeyword block above
    //   2. Add an entry here with label, accessory (SVG string), particles
    //   3. Update hook.js classifyTool() to emit that keyword
    //
    // Accessory: inline SVG string positioned relative to creature
    // Particles: { items: [svgStrings], anim: keyframeName, rate: ms }

    const ANIMATIONS = {
      idle: {
        label: "chilling...",
        accessory: null,
        particles: null,
      },

      thinking: {
        label: "thinking...",
        // Thought bubble with animated dots
        accessory: `<svg viewBox="0 0 40 32" width="34" height="28" style="top:-14px;left:62px;">
          <ellipse cx="20" cy="12" rx="17" ry="12" fill="rgba(255,255,255,0.85)" stroke="#ddd" stroke-width="0.8"/>
          <circle cx="10" cy="26" r="3" fill="rgba(255,255,255,0.7)"/>
          <circle cx="6" cy="30" r="2" fill="rgba(255,255,255,0.5)"/>
          <circle cx="12" cy="12" r="2" fill="#f0932b" opacity="0.8">
            <animate attributeName="r" values="1.5;2.5;1.5" dur="1.2s" repeatCount="indefinite"/>
          </circle>
          <circle cx="20" cy="12" r="2" fill="#f0932b" opacity="0.8">
            <animate attributeName="r" values="1.5;2.5;1.5" dur="1.2s" begin="0.3s" repeatCount="indefinite"/>
          </circle>
          <circle cx="28" cy="12" r="2" fill="#f0932b" opacity="0.8">
            <animate attributeName="r" values="1.5;2.5;1.5" dur="1.2s" begin="0.6s" repeatCount="indefinite"/>
          </circle>
        </svg>`,
        particles: {
          items: [SVG.dot("#f0932b"), SVG.dot("#ffbe76"), SVG.ring("#f0932b"), SVG.sparkle("#ffbe76")],
          anim: "sway-float", rate: 1000,
        },
      },

      coding: {
        label: "coding!",
        // MacBook-style laptop — silver unibody, lid with Apple-like glow, matching width base
        accessory: `<svg viewBox="0 0 50 28" width="46" height="26" style="top:68px;left:37px;">
          <!-- screen glow behind lid -->
          <rect x="7" y="0" width="36" height="18" rx="2" fill="#74b9ff" opacity="0.12">
            <animate attributeName="opacity" values="0.08;0.22;0.08" dur="2s" repeatCount="indefinite"/>
          </rect>
          <!-- lid (white) -->
          <rect x="7" y="0" width="36" height="18" rx="2" fill="#f5f5f7" stroke="#d2d2d7" stroke-width="0.6"/>
          <!-- Apple-style glowing logo on lid -->
          <ellipse cx="25" cy="9" rx="3" ry="3.6" fill="#74b9ff" opacity="0.3">
            <animate attributeName="opacity" values="0.2;0.5;0.2" dur="2.5s" repeatCount="indefinite"/>
          </ellipse>
          <!-- glow leaking over top edge -->
          <rect x="9" y="0" width="32" height="1.5" rx="0.75" fill="#74b9ff" opacity="0.18">
            <animate attributeName="opacity" values="0.1;0.3;0.1" dur="1.8s" repeatCount="indefinite"/>
          </rect>
          <!-- hinge line -->
          <rect x="7" y="18" width="36" height="1.2" rx="0.5" fill="#d2d2d7"/>
          <!-- keyboard base (same width as lid, flat) -->
          <rect x="7" y="19.2" width="36" height="7" rx="1" fill="#f5f5f7" stroke="#d2d2d7" stroke-width="0.5"/>
          <!-- trackpad -->
          <rect x="18" y="22.5" width="14" height="3" rx="1" fill="#e8e8ed" stroke="#d2d2d7" stroke-width="0.4"/>
          <!-- key rows -->
          <circle cx="12" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
          <circle cx="15" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
          <circle cx="18" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
          <circle cx="21" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
          <circle cx="24" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
          <circle cx="27" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
          <circle cx="30" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
          <circle cx="33" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
          <circle cx="36" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
          <circle cx="39" cy="21.2" r="0.6" fill="#c7c7cc" opacity="0.6"/>
        </svg>`,
        particles: {
          items: [
            // Blue - keywords
            `<span style="color:#74b9ff;font-size:11px;font-weight:bold;font-family:monospace;text-shadow:0 0 4px rgba(116,185,255,0.5)">fn</span>`,
            `<span style="color:#74b9ff;font-size:11px;font-weight:bold;font-family:monospace;text-shadow:0 0 4px rgba(116,185,255,0.5)">if</span>`,
            `<span style="color:#74b9ff;font-size:11px;font-weight:bold;font-family:monospace;text-shadow:0 0 4px rgba(116,185,255,0.5)">let</span>`,
            // Green - strings
            `<span style="color:#2ecc71;font-size:10px;font-family:monospace;text-shadow:0 0 4px rgba(46,204,113,0.4)">"ok"</span>`,
            // Orange/yellow - operators & brackets
            `<span style="color:#f9ca24;font-size:11px;font-family:monospace;text-shadow:0 0 4px rgba(249,202,36,0.4)">=></span>`,
            `<span style="color:#f0932b;font-size:12px;font-family:monospace;text-shadow:0 0 4px rgba(240,147,43,0.4)">{}</span>`,
            `<span style="color:#fdcb6e;font-size:11px;font-family:monospace;text-shadow:0 0 4px rgba(253,203,110,0.4)">()</span>`,
            // Pink - numbers
            `<span style="color:#fd79a8;font-size:11px;font-family:monospace;text-shadow:0 0 4px rgba(253,121,168,0.4)">42</span>`,
            `<span style="color:#e84393;font-size:10px;font-family:monospace;text-shadow:0 0 4px rgba(232,67,147,0.4)">0x</span>`,
            // SVG sparkles in code-accent colors
            SVG.sparkle("#74b9ff"),
            SVG.sparkle("#2ecc71"),
            SVG.sparkle("#f9ca24"),
          ],
          anim: "float-up", rate: 500,
        },
      },

      success: {
        label: "done!",
        // Animated sparkle burst with spinning star and pulse ring
        accessory: `<svg viewBox="0 0 36 36" width="30" height="30" style="top:-12px;left:42px;">
          <path d="M18,2 L20,14 L32,16 L20,18 L18,30 L16,18 L4,16 L16,14Z" fill="#2ecc71" opacity="0.8">
            <animateTransform attributeName="transform" type="rotate" values="0 18 16;360 18 16" dur="4s" repeatCount="indefinite"/>
          </path>
          <circle cx="18" cy="16" r="4" fill="#27ae60">
            <animate attributeName="r" values="3;5;3" dur="0.8s" repeatCount="indefinite"/>
          </circle>
          <circle cx="18" cy="16" r="6" fill="none" stroke="#2ecc71" stroke-width="1" opacity="0.4">
            <animate attributeName="r" values="4;10;4" dur="1.2s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.5;0;0.5" dur="1.2s" repeatCount="indefinite"/>
          </circle>
        </svg>`,
        particles: {
          items: [SVG.star("#2ecc71"), SVG.sparkle("#27ae60"), SVG.check("#00b894"), SVG.star("#55efc4")],
          anim: "pop-up", rate: 400,
        },
      },

      error: {
        label: "uh oh...",
        // Flashing warning triangle
        accessory: `<svg viewBox="0 0 28 26" width="22" height="20" style="top:-4px;left:46px;">
          <polygon points="14,2 26,24 2,24" fill="#ffeaa7" stroke="#e17055" stroke-width="1.5" stroke-linejoin="round">
            <animate attributeName="fill" values="#ffeaa7;#fff3c4;#ffeaa7" dur="0.6s" repeatCount="indefinite"/>
          </polygon>
          <line x1="14" y1="10" x2="14" y2="17" stroke="#e17055" stroke-width="2.5" stroke-linecap="round"/>
          <circle cx="14" cy="21" r="1.5" fill="#e17055">
            <animate attributeName="r" values="1.5;2;1.5" dur="0.6s" repeatCount="indefinite"/>
          </circle>
        </svg>`,
        particles: {
          items: [SVG.cross("#e74c3c"), SVG.tri("#e17055"), SVG.sparkle("#ff7675"), SVG.bolt("#e74c3c")],
          anim: "crack-shake", rate: 600,
        },
      },

      // ── EXTENDED ──────────────────────────────────────────────────

      searching: {
        label: "searching...",
        // Animated magnifying glass that bobs with the body
        accessory: `<svg viewBox="0 0 32 32" width="26" height="26" style="top:-4px;left:72px;animation:search-peer 1.2s ease-in-out infinite;">
          <circle cx="13" cy="13" r="9" fill="none" stroke="#0984e3" stroke-width="2.5"/>
          <circle cx="13" cy="13" r="5" fill="#74b9ff" opacity="0.25">
            <animate attributeName="opacity" values="0.15;0.4;0.15" dur="1.5s" repeatCount="indefinite"/>
          </circle>
          <line x1="20" y1="20" x2="29" y2="29" stroke="#0984e3" stroke-width="3" stroke-linecap="round"/>
        </svg>`,
        particles: {
          items: [SVG.dot("#74b9ff"), SVG.ring("#0984e3"), SVG.sparkle("#a29bfe"), SVG.dot("#a29bfe")],
          anim: "orbit", rate: 800,
        },
      },

      reading: {
        label: "reading...",
        // Open book with page-turn shimmer
        accessory: `<svg viewBox="0 0 36 28" width="30" height="24" style="top:68px;left:42px;">
          <path d="M2,4 L17,2 L17,24 L2,22Z" fill="#a29bfe" stroke="#6c5ce7" stroke-width="1"/>
          <path d="M17,2 L32,4 L32,22 L17,24Z" fill="#d5ccff" stroke="#6c5ce7" stroke-width="1"/>
          <line x1="17" y1="2" x2="17" y2="24" stroke="#6c5ce7" stroke-width="1.5"/>
          <line x1="5" y1="8" x2="14" y2="7" stroke="#fff" stroke-width="1" opacity="0.6"/>
          <line x1="5" y1="12" x2="14" y2="11" stroke="#fff" stroke-width="1" opacity="0.6"/>
          <line x1="5" y1="16" x2="12" y2="15" stroke="#fff" stroke-width="1" opacity="0.6"/>
          <line x1="20" y1="7" x2="29" y2="8" stroke="#6c5ce7" stroke-width="1" opacity="0.3"/>
          <line x1="20" y1="11" x2="29" y2="12" stroke="#6c5ce7" stroke-width="1" opacity="0.3"/>
          <rect x="17" y="2" width="15" height="22" fill="#fff" opacity="0">
            <animate attributeName="opacity" values="0;0.15;0" dur="3s" repeatCount="indefinite"/>
          </rect>
        </svg>`,
        particles: {
          items: [SVG.page("#a29bfe"), SVG.sparkle("#6c5ce7"), SVG.dot("#d5ccff")],
          anim: "sway-float", rate: 1400,
        },
      },

      debugging: {
        label: "debugging!",
        // Bug orbiting the creature
        accessory: `<svg viewBox="0 0 24 24" width="22" height="22" style="top:8px;left:84px;animation:orbit 3s linear infinite;">
          <ellipse cx="12" cy="14" rx="5" ry="6.5" fill="#e84393"/>
          <circle cx="12" cy="7" r="3.5" fill="#e84393"/>
          <circle cx="10.5" cy="6" r="1.2" fill="#fff"/>
          <circle cx="13.5" cy="6" r="1.2" fill="#fff"/>
          <circle cx="10.5" cy="6" r="0.6" fill="#2c1810"/>
          <circle cx="13.5" cy="6" r="0.6" fill="#2c1810"/>
          <line x1="7" y1="11" x2="4" y2="8" stroke="#e84393" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="17" y1="11" x2="20" y2="8" stroke="#e84393" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="7" y1="16" x2="4" y2="18" stroke="#e84393" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="17" y1="16" x2="20" y2="18" stroke="#e84393" stroke-width="1.2" stroke-linecap="round"/>
        </svg>`,
        particles: {
          items: [SVG.bug("#fd79a8"), SVG.cross("#e84393"), SVG.sparkle("#ff7675")],
          anim: "wiggle-float", rate: 900,
        },
      },

      installing: {
        label: "installing...",
        // Animated progress bar
        accessory: `<svg viewBox="0 0 60 14" width="54" height="12" style="top:-12px;left:33px;">
          <rect x="0" y="0" width="54" height="12" rx="6" fill="rgba(0,0,0,0.3)"/>
          <rect x="2" y="2" width="10" height="8" rx="4" fill="#00cec9">
            <animate attributeName="width" values="5;50;5" dur="2s" repeatCount="indefinite"/>
          </rect>
          <rect x="2" y="2" width="50" height="8" rx="4" fill="none" stroke="#00b894" stroke-width="0.5" opacity="0.4"/>
        </svg>`,
        particles: {
          items: [SVG.gear("#00cec9"), SVG.diamond("#00b894"), SVG.dot("#55efc4")],
          anim: "float-up", rate: 1000,
        },
      },

      testing: {
        label: "testing...",
        // Clipboard with animated checkmarks appearing sequentially
        accessory: `<svg viewBox="0 0 28 34" width="22" height="26" style="top:-8px;left:76px;">
          <rect x="2" y="4" width="24" height="28" rx="2" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="1.2"/>
          <rect x="8" y="0" width="12" height="6" rx="2" fill="#f0932b"/>
          <rect x="10" y="1.5" width="8" height="3" rx="1" fill="#ffeaa7"/>
          <path d="M6,13 L8.5,15.5 L13,11" fill="none" stroke="#00b894" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="12" stroke-dashoffset="12">
            <animate attributeName="stroke-dashoffset" values="12;0;0" dur="2s" repeatCount="indefinite"/>
          </path>
          <line x1="15" y1="13" x2="22" y2="13" stroke="#2d3436" stroke-width="1.2" stroke-linecap="round"/>
          <path d="M6,20 L8.5,22.5 L13,18" fill="none" stroke="#00b894" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="12" stroke-dashoffset="12">
            <animate attributeName="stroke-dashoffset" values="12;12;0;0" dur="2s" repeatCount="indefinite"/>
          </path>
          <line x1="15" y1="20" x2="20" y2="20" stroke="#2d3436" stroke-width="1.2" stroke-linecap="round"/>
          <circle cx="9" cy="27.5" r="2" fill="none" stroke="#fdcb6e" stroke-width="1.5" stroke-dasharray="4 8">
            <animateTransform attributeName="transform" type="rotate" values="0 9 27.5;360 9 27.5" dur="1s" repeatCount="indefinite"/>
          </circle>
          <line x1="15" y1="27" x2="22" y2="27" stroke="#b2bec3" stroke-width="1.2" stroke-linecap="round"/>
        </svg>`,
        particles: {
          items: [SVG.check("#00b894"), SVG.check("#00cec9"), SVG.cross("#fdcb6e"), SVG.sparkle("#ffeaa7")],
          anim: "pop-up", rate: 900,
        },
      },

      deploying: {
        label: "deploying!",
        // Rocket ship with animated exhaust flames
        accessory: `<svg viewBox="0 0 24 44" width="18" height="34" style="top:-20px;left:48px;animation:deploy-launch 1.5s ease-in-out infinite;">
          <ellipse cx="12" cy="14" rx="7" ry="14" fill="#dfe6e9"/>
          <ellipse cx="12" cy="10" rx="5" ry="8" fill="#74b9ff"/>
          <circle cx="12" cy="10" r="3" fill="#0984e3"/>
          <circle cx="12" cy="10" r="1.5" fill="#fff" opacity="0.6"/>
          <path d="M5,18 L2,26 L7,22Z" fill="#e17055"/>
          <path d="M19,18 L22,26 L17,22Z" fill="#e17055"/>
          <ellipse cx="12" cy="28" rx="4" ry="2" fill="#fdcb6e"/>
          <path d="M9,28 L8,36 L12,32 L16,36 L15,28" fill="#e17055" opacity="0.8">
            <animate attributeName="d" values="M9,28 L8,36 L12,32 L16,36 L15,28;M9,28 L7,40 L12,34 L17,40 L15,28;M9,28 L8,36 L12,32 L16,36 L15,28" dur="0.3s" repeatCount="indefinite"/>
          </path>
          <path d="M10,30 L9,38 L12,35 L15,38 L14,30" fill="#fdcb6e" opacity="0.7">
            <animate attributeName="d" values="M10,30 L9,38 L12,35 L15,38 L14,30;M10,30 L8,42 L12,37 L16,42 L14,30;M10,30 L9,38 L12,35 L15,38 L14,30" dur="0.25s" repeatCount="indefinite"/>
          </path>
        </svg>`,
        particles: {
          items: [SVG.bolt("#fdcb6e"), SVG.star("#ff7675"), SVG.sparkle("#e17055"), SVG.sparkle("#fdcb6e")],
          anim: "float-up", rate: 300,
        },
      },

      cooking: {
        label: "cooking...",
        // Chef hat
        accessory: `<svg viewBox="0 0 40 28" width="36" height="24" style="top:-8px;left:38px;">
          <ellipse cx="20" cy="20" rx="16" ry="5" fill="#fff" stroke="#dfe6e9" stroke-width="1"/>
          <ellipse cx="12" cy="12" rx="8" ry="9" fill="#fff"/>
          <ellipse cx="28" cy="12" rx="8" ry="9" fill="#fff"/>
          <ellipse cx="20" cy="8" rx="9" ry="9" fill="#fff"/>
          <rect x="6" y="15" width="28" height="6" fill="#fff"/>
          <ellipse cx="20" cy="20" rx="16" ry="5" fill="none" stroke="#dfe6e9" stroke-width="1"/>
        </svg>`,
        particles: {
          items: [SVG.cloud("#dfe6e9"), SVG.cloud("#b2bec3"), SVG.sparkle("#fdcb6e")],
          anim: "sway-float", rate: 700,
        },
      },

      hatching: {
        label: "hatching...",
        // Cracking egg under the creature
        accessory: `<svg viewBox="0 0 50 38" width="44" height="34" style="top:56px;left:36px;animation:crack-shake 1s ease-in-out infinite;">
          <ellipse cx="25" cy="22" rx="20" ry="16" fill="#ffeaa7" stroke="#f0932b" stroke-width="1.2"/>
          <ellipse cx="25" cy="22" rx="20" ry="16" fill="none" stroke="#fdcb6e" stroke-width="0.8"/>
          <path d="M12,16 L16,8 L20,16 L25,6 L30,16 L34,10 L38,16" fill="none" stroke="#f0932b" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <line x1="21" y1="14" x2="23" y2="22" stroke="#f0932b" stroke-width="0.8" opacity="0.5"/>
          <line x1="28" y1="12" x2="27" y2="20" stroke="#f0932b" stroke-width="0.8" opacity="0.5"/>
          <line x1="18" y1="16" x2="19" y2="20" stroke="#f0932b" stroke-width="0.8" opacity="0.4"/>
        </svg>`,
        particles: {
          items: [SVG.sparkle("#fdcb6e"), SVG.star("#ffeaa7"), SVG.dot("#f0932b")],
          anim: "pop-up", rate: 1500,
        },
      },

      deleting: {
        label: "cleaning up...",
        // Broom
        accessory: `<svg viewBox="0 0 18 38" width="14" height="30" style="top:14px;left:92px;animation:delete-sweep 0.6s ease-in-out infinite;">
          <rect x="7" y="0" width="4" height="24" rx="2" fill="#b2bec3"/>
          <rect x="0" y="22" width="18" height="14" rx="3" fill="#636e72"/>
          <line x1="3" y1="26" x2="3" y2="34" stroke="#2d3436" stroke-width="1" stroke-linecap="round"/>
          <line x1="7" y1="26" x2="7" y2="35" stroke="#2d3436" stroke-width="1" stroke-linecap="round"/>
          <line x1="11" y1="26" x2="11" y2="35" stroke="#2d3436" stroke-width="1" stroke-linecap="round"/>
          <line x1="15" y1="26" x2="15" y2="34" stroke="#2d3436" stroke-width="1" stroke-linecap="round"/>
        </svg>`,
        particles: {
          items: [SVG.dust("#b2bec3"), SVG.cross("#636e72"), SVG.dot("#dfe6e9")],
          anim: "wiggle-float", rate: 800,
        },
      },

      downloading: {
        label: "downloading...",
        // Progress bar (blue variant)
        accessory: `<svg viewBox="0 0 60 14" width="54" height="12" style="top:-12px;left:33px;">
          <rect x="0" y="0" width="54" height="12" rx="6" fill="rgba(0,0,0,0.3)"/>
          <rect x="2" y="2" width="10" height="8" rx="4" fill="#74b9ff">
            <animate attributeName="width" values="5;50;5" dur="3s" repeatCount="indefinite"/>
          </rect>
          <rect x="2" y="2" width="50" height="8" rx="4" fill="none" stroke="#0984e3" stroke-width="0.5" opacity="0.4"/>
        </svg>`,
        particles: {
          items: [SVG.page("#74b9ff"), SVG.arrowDown("#0984e3"), SVG.dot("#a29bfe")],
          anim: "rain-down", rate: 600,
        },
      },
    };

    // ── STATE MANAGEMENT ────────────────────────────────────────────

    function setState(state) {
      const config = ANIMATIONS[state] || ANIMATIONS["thinking"];
      const effectiveState = ANIMATIONS[state] ? state : "thinking";

      if (currentState === effectiveState) return;

      scene.className = "scene state-" + effectiveState;
      label.textContent = config.label || effectiveState;
      currentState = effectiveState;

      updateAccessories(config);
      updateParticles(config);
    }

    function updateAccessories(config) {
      accessoryLayer.innerHTML = "";
      if (config.accessory) {
        accessoryLayer.innerHTML = config.accessory;
        requestAnimationFrame(() => {
          accessoryLayer.querySelectorAll("svg").forEach((s) => s.classList.add("active"));
        });
      }
    }

    function updateParticles(config) {
      if (particleInterval) {
        clearInterval(particleInterval);
        particleInterval = null;
      }
      particleLayer.innerHTML = "";
      if (!config.particles) return;

      const { items, anim, rate } = config.particles;
      let idx = 0;

      function spawnParticle() {
        const el = document.createElement("div");
        el.className = "p";
        el.innerHTML = items[idx % items.length];
        idx++;

        const x = 10 + Math.random() * 120;
        el.style.left = x + "px";
        el.style.top = "60px";
        el.style.animation = `${anim} ${1.5 + Math.random() * 1}s ease-out forwards`;
        el.style.animationDelay = (Math.random() * 0.3) + "s";

        particleLayer.appendChild(el);
        setTimeout(() => { if (el.parentNode) el.parentNode.removeChild(el); }, 3500);
      }

      spawnParticle();
      particleInterval = setInterval(spawnParticle, rate);
    }

    // ── IPC ─────────────────────────────────────────────────────────

    ipcRenderer.on("status-change", (e, status) => setState(status));
    setState("idle");

    // ── MOUSE EYE TRACKING ──────────────────────────────────────────

    document.addEventListener("mousemove", (e) => {
      const noTrack = ["thinking", "searching", "reading", "installing", "downloading", "coding", "cooking", "testing"];
      if (noTrack.includes(currentState)) return;

      const pupils = document.querySelectorAll(".pupil");
      pupils.forEach((p) => {
        const rect = p.parentElement.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        const dx = Math.max(-3, Math.min(3, (e.clientX - cx) * 0.05));
        const dy = Math.max(-2, Math.min(2, (e.clientY - cy) * 0.05));
        p.style.transform = `translate(${dx}px, ${dy}px)`;
      });
    });
  </script>
</body>
</html>
